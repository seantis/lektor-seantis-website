<!doctype html>
<html class="no-js" lang="de" dir="ltr" prefix="og: http://ogp.me/ns#">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>seantis gmbh</title>
    <meta name="description"
        content="seantis gmbh entwickelt Webapplikationen f√ºr die medizinische Forschung, die √∂ffentliche Verwaltung sowie f√ºr die Aviatik.">
    <meta property="og:description" content="">
    <meta property="og:site_name" content="seantis">
<meta property="og:url" content="https://www.seantis.ch/blog/deployment-buildout/">
<meta property="og:title" content="Deployment Buildout">
<meta property="og:type" content="website">
<meta property="og:image" content="https://www.seantis.ch/og_image.jpg">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="og:image:type" content="image/jpeg">
<meta property="og:image:alt" content="logo">
    <link rel="stylesheet" href="/static/css/foundation.min.css?h=883e6026">
    <link rel="stylesheet" href="/static/css/fira.css?h=bcd50a1c">
    <link rel="stylesheet" href="/static/css/fontawesome.min.css?h=20d2d431">
    <link rel="stylesheet" href="/static/css/custom.css?h=85151875">
    <link rel="stylesheet" href="/static/css/aos.css?h=9a26a349" />
</head>

<body class="model-blog-post">

    <div class="off-canvas position-left" id="offCanvas" data-off-canvas>

        <!-- Close button -->
        <button class="close-button" aria-label="Close menu" type="button" data-close>
            <span aria-hidden="true">&times;</span>
        </button>

        <!-- Menu -->
        <ul class="menu" data-dropdown-menu>
            
            
            <li class=" "><a href="/portrait/">√úber uns</a></li>
            
            <li class=" "><a href="/engineering/">Engineering</a></li>
            
            <li class=" "><a href="/services/">Services</a></li>
            
            <li class=" "><a href="/academy/">Academy</a></li>
            
            <li class=" "><a href="/success-stories/">Erfolgsgeschichten</a></li>
            
            <li class=" "><a href="/news/">News</a></li>
            
            <li class=" "><a href="/careers/">Jobs</a></li>
            
            <li class=" active"><a href="/blog/">Blog</a></li>
            
            <li class="contact "><a href="/contact/">Kontakt</a></li>
            
        </ul>

    </div>

    <div class="off-canvas-content" data-off-canvas-content>
        <!-- <div class="announcement"><a href="/news/job-python-entwickler/">&rarr; Jobs: Full Stack Python-Entwickler(in) (60-100%)<i class="fab fa-python"></i></a></div> -->
        <!-- <div class="announcement"><a href="/news/deep-learning-rheumatologie/">&rarr; Wissenschaftliche Publikation zur Anwendung von Deep Learning in der Rheumatologie <i class="far fa-newspaper"></i></a></div> -->
        <!-- <div class="announcement"><a href="/news/covid-19/">&rarr; Studie zu COVID-19 f√ºr Rheumapatienten <i class="far fa-newspaper"></i></a></div> -->
        <!-- <div class="announcement"><a href="/news/job-apprenticeship-application-developer/">üë©‚Äçüíª Lehrstelle als Informatiker (Fachrichtung Applikationsentwicklung) ab Sommer 2021 oder 2022</a></div> -->
        <!-- <div class="announcement"><a href="/blog/nzz-hackback/">üõ°Gastkommentar Cyber Security @NZZ #donthackback ‚öîÔ∏è</a></div>-->
        <!-- <div class="announcement"><a href="/success-stories/aircraft-configurator-pilatus/">Digitaler Konfigurator f√ºr die Pilatus Flugzeugwerke üõ©</a></div>-->
        <!-- <div class="announcement"><a href="/portrait/informationssicherheit-iso-27001/"> ISO 27001 zertifiziertes Informationssicherheits-Managementsystem üõ°</a></div>-->
        <!-- <div class="announcement"><a href="/blog/publikationsportal-wahlen-open-source/"> Unser Praxisbeispiel in der Open Source Studie Schweiz 2021 üó≥</a></div> -->
        <div class="announcement"><a href="/blog/cybersecurity-resilienz-resignation/">üßÄ Schweizer K√§se statt Burgmauern f√ºr bessere Informationssicherheit üè∞</a></div>


        <div data-sticky-container>
            <div class="sticky" data-sticky data-sticky-on="small" data-margin-top="0">
                <div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium"
                    style="display:none">
                    <button type="button" class="menu-icon" data-toggle="offCanvas"></button>
                    <div class="title-bar-title"> <a href="/">Home</a></div>
                    <div class="title-bar-right contact"><a href="/contact/">Kontakt</a></div>
                </div>

                <div class="top" id="responsive-menu" style="display:none">
                    <div class="grid-container">
                        <div class="top-bar">
                            <div class="top-bar-left">
                                <ul class="menu hide-for-small-only">
                                    <li><a href="/">Home</a></li>
                                </ul>
                            </div>
                            <div class="top-bar-right">
                                <ul class="menu" data-dropdown-menu>
                                    
                                    <li class=" "><a
                                            href="/portrait/">√úber uns</a></li>
                                    
                                    <li class=" "><a
                                            href="/engineering/">Engineering</a></li>
                                    
                                    <li class=" "><a
                                            href="/services/">Services</a></li>
                                    
                                    <li class=" "><a
                                            href="/academy/">Academy</a></li>
                                    
                                    <li class=" "><a
                                            href="/success-stories/">Erfolgsgeschichten</a></li>
                                    
                                    <li class=" "><a
                                            href="/news/">News</a></li>
                                    
                                    <li class=" "><a
                                            href="/careers/">Jobs</a></li>
                                    
                                    <li class=" active"><a
                                            href="/blog/">Blog</a></li>
                                    
                                    <li class="contact "><a
                                            href="/contact/">Kontakt</a></li>
                                    
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid-container">
            <div class="header">
                <div class="top-bar">
                    <div class="top-bar-left">
                        <a href="/"><img id="logo" src="/static/img/logo.svg"
                                alt="Zur Startseite" /></a>
                    </div>
                    <div class="top-bar-right">
                        <form action="/search/">
                            <div class="input-group show-for-medium">
                                <input class="input-group-field" type="search" name="q" id="tipue_search_input">
                                <div class="input-group-button">
                                    <input type="submit" class="button" value="Suche">
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        

    <div class="head">
        <div class="grid-container">
            <div class="grid-x grid-padding-x">
                <div class="large-7 large-offset-1 medium-10 medium-offset-1 cell">
                    <h5 class="subheader"><small>28.06.2010</small></h5>
                    <h1>Deployment Buildout</h1>
                    <p class="lead"></p>
                </div>
            </div>
        </div>
    </div>

    
    

    <div class="grid-container">
        <div class="grid-x grid-margin-x">
            <div class="large-7 large-offset-1 medium-9 medium-offset-1 cell">
                <div class="main-content">
                    <p>F√ºr ein Plone-Projekt mit vielen Seitenzugriffen ist ein gutes Setup auf den
Live-Servern zentral. Nur mit einer ausgefeilten Konfiguaration inkl. Caching
l√§sst sich eine gute Performance erreichen.</p>
<p>Mittels buildout l√§sst sich einfach eine schnelle Konfiguration aufsetzen:</p>
<ul>
<li><p>nginx: <a href="http://wiki.codemongers.com/Main">http://wiki.codemongers.com/Main</a></p>
</li>
<li><p>varnish: <a href="http://varnish.projects.linpro.no/">http://varnish.projects.linpro.no/</a></p>
</li>
<li><p>supervisor: <a href="http://supervisord.org/">http://supervisord.org/</a></p>
</li>
<li><p>1 ZEO-Server / 2 ZEO-Instanzen: primary und secondary</p>
</li>
<li><p>Rotation der log-files</p>
</li>
<li>Persistente Sessions</li>
</ul>
<p>Die Konfiguration f√ºr den Produktivbetrieb findet sich im deployment.cfg. Die
Konfiguration in der Datei ist zus√§tzlich zu den Angaben im eigentlichen
buildout des Projektes (buildout.cfg).</p>
<p>Um diese Umgebung aufzusetzen, die Konfigurationsdatei explizit angeben:</p>
<pre><code>¬†$ ./bin/buildout -c deployment.cfg
</code></pre>
<p>Alles starten / stoppen:</p>
<pre><code>¬†$ ./bin/supervisorctl start all¬†¬†   
¬†$ ./bin/supervisorctl stop all  
</code></pre>
<p>Um den Cache komplett zu leeren:</p>
<pre><code> $ telnet localhost 6082  
   -- url.purge .*  
   -- quit  
</code></pre>
<p>Das gesamte deployment.cfg:</p>
<pre><code>[buildout]  
extends =  
    buildout.cfg  

parts =  
    plone  
    zope2  
    productdistros  
    deploymentproducts  

    zeoserver  
    instance1  
    instance2  

    varnish-build  
    varnish-instance  

    nginx-build  
    nginx-instance  

    supervisor  
    logrotate.conf  

[deploymentproducts]  
recipe = plone.recipe.distros  
urls =  
    http://plone.org/products/cachefu/releases/1.1/CacheFu-1.1.tgz  
nested-packages =  
    CacheFu-1.1.tgz  
version-suffix-packages =   

[zeoserver]  
recipe = plone.recipe.zope2zeoserver  
zope2-location = ${zope2:location}  
zeo-address = 127.0.0.1:8100  
effective-user = user  
zeo-conf-additional =  
     %import tempstorage  
     &lt;temporarystorage temp&gt;  
         name temp storage for sessioning  
     &lt;/temporarystorage&gt;   

[instance1]  
recipe = collective.recipe.zope2cluster  
instance-clone = instance  
zope2-location = ${zope2:location}  
zeo-client = true  
zeo-address = ${zeoserver:zeo-address}  
debug-mode = off  
verbose-security = off  
zodb-cache-size = 5000  
zeo-client-cache-size = 300MB  
http-address = 8080  
effective-user = user  
zodb-temporary-storage =  
    &lt;zodb_db temporary&gt;  
      &lt;zeoclient&gt;  
        server 127.0.0.1:8100  
        storage temp  
        name zeostorage  
        var ${buildout:directory}/var/filestorage  
      &lt;/zeoclient&gt;  
      mount-point /temp_folder  
      container-class Products.TemporaryFolder.TemporaryContainer  
    &lt;/zodb_db&gt;   

[instance2]  
recipe = collective.recipe.zope2cluster  
instance-clone = instance  
zope2-location = ${zope2:location}  
zeo-client = true  
zeo-address = ${zeoserver:zeo-address}  
debug-mode = off  
verbose-security = off  
zodb-cache-size = 5000  
zeo-client-cache-size = 300MB  
http-address = 8081  
effective-user = user  
zope-conf-additional = zserver-threads 1  
zodb-temporary-storage = ${instance1:zodb-temporary-storage}  

[varnish-build]  
recipe = zc.recipe.cmmi  
url = http://puzzle.dl.sourceforge.net/sourceforge/varnish/varnish-2.0.2.tar.gz  

[varnish-instance]  
recipe = plone.recipe.varnish  
daemon = ${buildout:directory}/parts/varnish-build/sbin/varnishd  
bind = *:80  
backends = 127.0.0.1:8201  
cache-size = 1G  
telnet = 127.0.0.1:6082  
mode = foreground  

[nginx-build]  
recipe = zc.recipe.cmmi  
url = http://sysoev.ru/nginx/nginx-0.6.34.tar.gz  
extra_options = --with-http_realip_module  

[nginx-instance]  
recipe = gocept.nginx  
nginx = nginx-build  
configuration =   
    user user;  
    error_log ${buildout:directory}/var/log/nginx-error.log warn;  
    worker_processes 1;  
    daemon off;   
    events {  
        worker_connections 1024;  
    }  
    http {  
        upstream zope {  
            server 127.0.0.1:${instance1:http-address} max_fails=3 fail_timeout=30s;  
            server 127.0.0.1:${instance2:http-address} max_fails=3 fail_timeout=30s;  
        }  
        server {  
            listen 127.0.0.1:8201;  
            server_name mydomain.ch www.mydomain.ch;  
            set_real_ip_from   127.0.0.1;  
            real_ip_header     X-Forwarded-For;  
            access_log ${buildout:directory}/var/log/nginx-access.log;  
            rewrite ^/(.*) /VirtualHostBase/http/www.mydomain.ch:80/myplonesite/VirtualHostRoot/$1 last;  
            location / {  
                proxy_pass http://zope;  
            }  
        }  
    }  

[supervisor]  
recipe = collective.recipe.supervisor  
port = 127.0.0.1:9001  
user = admin  
password = admin  
serverurl = http://127.0.0.1:9001  
programs =  
    10 zeo        ${buildout:directory}/parts/zeoserver/bin/runzeo  true user  
    20 instance1  ${buildout:directory}/parts/instance1/bin/runzope true user  
    20 instance2  ${buildout:directory}/parts/instance2/bin/runzope true user  
    30 varnish    ${buildout:directory}/bin/varnish-instance        true  
    40 nginx      ${nginx-build:location}/sbin/nginx [-c ${nginx-instance:run-directory}/nginx-instance.conf] true user  

[logrotate.conf]  
recipe = zc.recipe.deployment:configuration  
text =   
    rotate 4  
    weekly  
    create  
    compress  
    delaycompress  

    ${buildout:directory}/var/log/instance1*.log {  
        sharedscripts  
        postrotate  
            /bin/kill -USR2 $(cat ${buildout:directory}/var/instance1.pid)  
        endscript  
    }  

    ${buildout:directory}/var/log/instance2*.log {  
        sharedscripts  
        postrotate  
            /bin/kill -USR2 $(cat ${buildout:directory}/var/instance2.pid)  
        endscript  
    }  

    ${buildout:directory}/var/log/zeoserver.log {  
        postrotate  
            /bin/kill -USR2 $(cat ${buildout:directory}/var/zeoserver.pid)  
        endscript  
    }  

    ${buildout:directory}/var/log/nginx*.log {  
        sharedscripts  
        postrotate  
            /bin/kill -USR1 $(cat ${nginx-instance:run-directory}/nginx.pid)  
        endscript  
    }  
</code></pre>
<p><a href="http://plone.org/documentation/tutorial/buildout/a-deployment-configuration">http://plone.org/documentation/tutorial/buildout/a-deployment-configuration</a></p>
<p><a href="http://www.martinaspeli.net/articles/an-uber-buildout-for-a-production-plone-
server">http://www.martinaspeli.net/articles/an-uber-buildout-for-a-production-plone-
server</a></p>

                </div>
            </div>
        </div>
    </div>


        <footer>
            <div class="grid-container">
                <div class="grid-x grid-padding-x">
                    <div class="large-8 medium-8 cell">
                        <h4>Building data-driven web applications with an open-source toolset and an agile mindset</h4>
                        <p>Wir entwicklen qualitativ hochstehende Software. Dazu setzen wir auf die besten Open Source
                            Entwickler-Tools und arbeiten gem√§ss Agiler Methodik.</p>
                        <a href="http://www.swissmadesoftware.org">
                            <img id="swissmadesoftware" src="/static/img/swissmadesoftware.png"
                                alt="Swiss made software" />
                        </a>
                        <div class="bosw">
                            <a href="https://www.bestofswissweb.ch">
                                <img src="/static/img/bosw-2019.png" alt="Best of Swiss Web 2019" />
                                <img src="/static/img/bosw-2016.svg" alt="Best of Swiss Web 2016" />
                            </a>
                            <a href="https://www.berufsbildungplus.ch">
                                <img src="/static/img/vignette-sbfi.png" alt="Lehrbetrieb" />
                            </a>
                            <a href="/portrait/informationssicherheit-iso-27001/">
                                <img src="/static/img/SSC_ISO27001_transparent.png"
                                    alt="ISO/IEC 27001:2013" />
                            </a>
                        </div>
                    </div>
                    <div class="large-4 medium-4 cell">
                        <h5>Cloud Platform</h5>
                        <ul>
                            <li><a href="http://www.healthdata.ai">HealthData.ai</a></li>
                            <li><a href="https://admin.digital">OneGov Cloud</a></li>
                            <li><a href="http://www.mycontrol.aero">myControl.aero</a></li>
                        </ul>
                        <a class="button" href="/contact/">Kontakt</a>
                    </div>
                </div>

                <div class="grid-x grid-padding-x">
                    <div class="large-12 cell">
                        <div id="copyright">¬© 2005 - 2023 by seantis gmbh | Lektor powered &
                            built with Python</div>
                    </div>
                </div>

            </div>
        </footer>
    </div>

    <script src="/static/js/jquery.min.js?h=1055018c"></script>

    <script src="/static/js/aos.js?h=e38950c1"></script>
    <script>
        AOS.init();
    </script>

    <script src="/static/js/what-input.min.js?h=d37c555d"></script>
    <script src="/static/js/foundation.min.js?h=507bf6ca"></script>
    <script src="/static/js/tipuesearch_set.js?h=51d521ed"></script>
    <script src="/static/js/tipuesearch.min.js?h=bd976a7c"></script>
    <script src="/static/js/app.js?h=a7d8dbf4"></script>

    <script>
        $(document).foundation();

        var _paq = _paq || [];
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function () {
            var u = "//stats.seantis.ch/";
            _paq.push(['setTrackerUrl', u + 'piwik.php']);
            _paq.push(['setSiteId', '15']);
            var d = document, g = d.createElement('script'), s = d.getElementsByTagName('script')[0];
            g.type = 'text/javascript'; g.async = true; g.defer = true; g.src = u + 'piwik.js'; s.parentNode.insertBefore(g, s);
        })();

        $(function () {
            $(".storybox-" + (new Date().getTime() % 4 + 1)).css("display", "block");
        });

         
    </script>

</body>

</html>
